<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial;
        }

        #notes {
            display: flex;
            flex-wrap: wrap;
        }
        .List{
            border: solid 1px #000000;
            flex: 1 auto;
            border-radius: 5px;
            padding: 5px;
        }

        .task {
            padding: 5px;
            flex: 1 auto;
            min-width: 350px;
            max-width: 350px;
            margin: 30px;
            height: 150px;
            padding:15px;
            color:#555555;
            border:solid 1px #999999;
            border-radius:5px;
        }

        button {
            border-radius: 10px;
            border: solid 0px #000000;
            font-size: 18pt;
            font-weight: lighter;
            padding: 5px 10px 5px 10px;
            background-color: #9999AA;
            color: white;
            outline: none;
            box-shadow: 2px 2px 2px #DDDDDD;

        }

        button:hover {
            background-color: #9999FF;
        }

        button:active {
            background-color: #333377;
            transform: translate(1px, 1px);
        }

        .deleteButton {
            border-radius: 50%;
            outline: none;
            background-color: #AA5555;
            float: right;
            width: 20px;
            height: 20px;
            font-size: 12pt;
            font-family: arial;
            font-weight: normal;
            box-shadow: 0px;
            padding: 0px;
        }

        .deleteButton:hover {
            background-color: #880000;
        }

        .deleteButton:active {
            background-color: #FF0000;
        }

        input, textarea {
            width: 100%;
            font-family: 14pt;
            color: #555555;
            padding: 5px;
        }

        #noteTitle {
            font-size: 18pt;
            border-width: 0px 0px 1px 0px;
            outline: none;

        }

        #noteText {
            height: 200px;
            font-size: 14pt;
            border: solid 1px #AAAAAA;
        }

        h3 {
            font-size: 20pt;
            font-weight: 100;
            letter-spacing: 1.2pt;
        }
        .noteTitle {
            font-size:12pt;
            border-bottom: solid 1px #888888;
            width:90%;
            background-color:#555588;
            padding:5px;
            color:#DDDDDD;
            border-radius:5px;
        }
        .noteText {
            font-size:10pt;
            padding:3px;
            color:#555555;
        }
    </style>

    <script>
        function createTask($listId) {
            var taskData ={
                "servicePath" : "/task/createTasks",
                "serviceRequest" : JSON.stringify({
                    "taskTitle" : document.getElementById("taskTitle").value,
                    "taskDescrip" : document.getElementById("taskDescrip").value,
                    "listId" : $listId // TODO: Find what listId is being used and use it instead
                })
            };

            $.ajax({
                url: "http://astralqueen.bw.edu/~dwalsh12/testProject/trello-2.0/webServices/services.php",
                type: 'post',
                data: taskData,
                error: function(XMLHttpRequest, textStatus, errorThrown){
                    console.log("Error occurred, please try again!" + XMLHttpRequest.status);
                },
                success: function(data) {
                    // Debugging - Uncomment to check data you received
                    //console.log("Received response: " + data);

                    // Parse data into response object
                    var response = JSON.parse(data);

                    // Set auth status
                    document.getElementById("taskResponse").innerHTML = response.TaskResponse;

                }
            });

        }
        function getTasks() {
            var information = {
                "servicePath": "/task/getTasks",
                "serviceRequest": JSON.stringify({
                    "listId": 1 // TODO: Find what listId is being used and use it instead
                })
            };

            $.ajax({
                url: "http://astralqueen.bw.edu/~dwalsh12/testProject/trello-2.0/webServices/services.php",
                type: 'post',
                data: information,
                error: function(XMLHttpRequest, testStatus, errorThrown){
                    console.log("Error occurred, please try again!" + XMLHttpRequest.status);
                },
                success: function(data){

                    var response = JSON.parse(data);


                    document.getElementById("listId1").innerHTML = "";
                    document.getElementById("listId1").style.display = "block";

                    for(var i =0; i<response.length;i++){
                        var TaskTemplate = document.getElementById("TaskTemplate").cloneNode(true);

                        var TaskTemplateText = TaskTemplate.querySelector("#TaskTemplateText");
                        TaskTemplateText.innerHTML = response[i].taskDescription;

                        var TaskTemplateTitle = TaskTemplate.querySelector("#TaskTemplateTitle");
                        TaskTemplateTitle.innerHTML = response[i].TaskTitle;

                        var TaskTemplateButton = TaskTemplate.querySelector("#TaskTemplateButton");

                        (function (i) {
                            TaskTemplateButton.addEventListener("click",function () {
                                response.splice(i,1);
                                getTasks();
                            });

                        }(i));

                        TaskTemplate.style.display = "block";

                        TaskTemplate.setAttribute("id", "taskId" + response[i].taskId);
                        document.getElementById("listId1").appendChild(TaskTemplate);
                    }
                }
            })

        }
        function getList(){
            var information = {
                "servicePath" : "/task/getList",
                "serviceRequest" : JSON.stringify({
                })
            };

            $.ajax({
                url: "http://astralqueen.bw.edu/~dwalsh12/testProject/trello-2.0/webServices/services.php",
                type: 'post',
                data: information,
                error: function(XMLHttpRequest, testStatus, errorThrown){
                    console.log("Error occurred, please try again!" + XMLHttpRequest.status);
                },
                success: function(data) {
                    console.log("Received response: " + data);

                    var response = JSON.parse(data);

                    document.getElementById("List").innerHTML = "";
                    document.getElementById("List").style.display = "block";

                    for(var i=0;i<response.length;i++){
                        //creates a new div element
                        var newDiv = document.createElement("div");

                        //sets the Id of the created div element to be equal to the list Id
                        newDiv.setAttribute("id","listId" + response[i].listId);

                        //creates text to put inside the newly created div element
                        var newContent = document.createTextNode(response.Title);

                        //attach the created text to the created div element
                        newDiv.appendChild(newContent);

                        document.getElementById("List").appendChild(newDiv);

                    }






                }
            })
        }
        function checkTasks() {
            setTimeout(getTasks,1000);
        }


// TODO: Align the div "AllTasks" to work with multiple divs holding multiple tasks
// TODO: Pretty it up

    </script>
    <meta charset="UTF-8">
    <title>Welcome</title>
</head>
<body onload="getList()">
Please enter the Task Title:
<input type="text" id="taskTitle"/>
<br />
<input type="text" id="taskDescrip" />


<br />
<br />
<button onclick="getTasks()">Get all tasks</button>

<div id="TaskTemplate" class="task" style="display:none">
    <button id="TaskTemplateButton" class="deleteButton">x</button>
    <div id="TaskTemplateTitle" class="noteTitle">Note Title</div>
    <div id="TaskTemplateText" class="noteText">
        Some note text
    </div>
</div>
<div id="List" style = "display: none">
</div>
<div id="listId1" class="List" style="display: none">

    <button onclick="createTask(1)">Create Task</button>
</div>
</body>
</html>